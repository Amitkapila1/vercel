const async=require("async"),express=require("express"),cluster=require("cluster"),{Pool:Pool,Client:Client}=require("pg");var compression=require("compression");const numCPUs=require("os").cpus().length;var http=require("http");const app=express(),port=8090,{JSDOM:JSDOM}=require("jsdom"),{window:window}=new JSDOM(""),$=require("jquery")(window),redis=require("redis"),client=redis.createClient(),cors=require("cors");var cookieParser=require("cookie-parser");app.use(cookieParser()),app.use(compression());const bodyParser=require("body-parser"),request=require("request"),path=require("path"),session=require("express-session");app.use(bodyParser.json({limit:"50mb"})),app.use(bodyParser.urlencoded({extended:!1})),app.use(bodyParser.raw());const fetch=require("node-fetch"),csrf=require("csurf");process.env.trendlynecookie="__utma=185246956.775644955.1603113261.1614010114.1614018734.3; _ga=GA1.2.775644955.1603113261; _gid=GA1.2.39707591.1656426055; _gat=1; csrftoken=lGfU7cAnlhGstuIficsDap3KoBq3ut0Zz9DGLnPd1qnKoD2KU03nvvqmIj6dL2HJ; .trendlyne=2r8aijrkip6d34942mkc2e9rpd729ur9";
app.get('*.js', (req, res, next) => {req.url = req.url + '.gz';res.set('Content-Encoding', 'gzip');next();});var csrfProtection=csrf({cookie:!0}),parseForm=bodyParser.urlencoded({extended:!1});const fs=require("fs"),axios=require("axios");var html2json=require("html2json").html2json,allowCrossDomain=function(e,t,o){t.header("Access-Control-Allow-Origin","*"),t.header("Access-Control-Allow-Methods","GET , PUT , POST , DELETE"),t.header("Access-Control-Allow-Headers","Origin,Content-Type, X-Requested-With,Accept, Cache-Control"),t.header("Access-Control-Allow-Headers","Origin,Content-Type, X-Requested-With,Accept, Cache-Control"),"OPTIONS"==e.method?t.sendStatus(200):o()};if(app.use(allowCrossDomain),cluster.isMaster){console.log(`Master ${process.pid} is running`);for(let e=0;e<numCPUs;e++)cluster.fork();cluster.on("exit",((e,t,o)=>{console.log(`worker ${e.process.pid} died`)}))}else{console.log(`Worker ${process.pid} started`),app.get("/api/cluster",((e,t)=>{let o=cluster.worker.id;t.send(`Running on worker with id ==> ${o}`)}));const e=require("axios-cookiejar-support").default,t=require("tough-cookie"),o=new Pool({user:"postgres",host:"localhost",database:"amit",password:"amit0605",port:"5432"}),a=(new Client({user:"amit",host:"localhost",database:"amit",password:"amit0605",port:"5432"}),{secret:"amit0605",id_login:"amit.kapila.2009@gmail.com",resave:!1,saveUninitialized:!1,cookie:{sameSite:"Lax"}});app.set("trust proxy",1),a.cookie.secure=!0,app.post("/api/mcvolume",(async function(e,t){const a=e.body.map((e=>{axios.get("https://priceapi.moneycontrol.com/pricefeed/nse/equitycash/"+e.mcsymbol).then((t=>{var a={Date:e.Date,Time:e.time,Name:e.name,Symbol:e.mcsymbol,CurrentVol:t.data.data.VOL,FiveDVol:t.data.data.DVolAvg5,TenDVol:t.data.data.DVolAvg10,TwentyDVol:t.data.data.DVolAvg20,ThirtyDVol:t.data.data.DVolAvg30,CPrice:t.data.data.pricecurrent,PChangeper:t.data.data.pricepercentchange,StockName:t.data.data.SC_FULLNM};console.log("executing mcvolume"),o.query("INSERT INTO mcvolume (info)  VALUES ($1)",[a],((e,t)=>{console.log(e,t)}))})).catch((e=>{console.log(e)}))}));try{await Promise.all(a)}catch(e){console.log(e)}})),app.post("/api/mcvolume1",(async function(e,t){const a=e.body.map((e=>{axios.get("https://priceapi.moneycontrol.com/pricefeed/nse/equitycash/"+e.mcsymbol1).then((t=>{var a={Date:e.Date,Time:e.time,Name:e.name,Symbol:e.mcsymbol,CurrentVol:t.data.data.VOL,FiveDVol:t.data.data.DVolAvg5,TenDVol:t.data.data.DVolAvg10,TwentyDVol:t.data.data.DVolAvg20,ThirtyDVol:t.data.data.DVolAvg30,CPrice:t.data.data.pricecurrent,PChangeper:t.data.data.pricepercentchange,StockName:t.data.data.SC_FULLNM};console.log("executing mcvolume1"),o.query("INSERT INTO mcvolume (info)  VALUES ($1)",[a],((e,t)=>{console.log(e,t)}))})).catch((e=>{console.log(e)}))}));try{await Promise.all(a)}catch(e){console.log(e)}})),app.get("/api/kotakview",(async function(e,t){let a=e.query.eqsymbol;const s=await o.query("select info ->>'IndCode' as IndCoded , info ->>'SectorId' as SectorId , info ->>'CompanyId' as CompanyId, info ->>'MarketCap' as MarketCap, info ->>'SectorName' as SectorName,info ->>'Finance' as Finance, info ->>'ValueScore' as ValueScore,info ->>'CompanyName' as CompanyName, info ->>'GrowthScore' as GrowthScore,info ->>'HealthScore' as HealthScore, info ->>'ReleaseDate' as ReleaseDate,info ->> 'QualityScore' as QualityScore,info ->> 'RankBySector' as RankBySector, info ->>'DividendScore' as DividendScore, info ->>'CompanyShortName' as CompanyShortName, info ->>'OverallMarketRank' as OverallMarketRank, info ->>'PastPerformanceScore' as PastPerformanceScore from kotaksec where info->>'CompanyShortName' = $1",[a]);t.json(s.rows)})),app.get("/api/kotaksectorview",(async function(e,t){let a=e.query.sectorid;console.log(a);const s=await o.query("select info ->>'IndCode' as IndCoded , info ->>'SectorId' as SectorId , info ->>'CompanyId' as CompanyId, info ->>'MarketCap' as MarketCap, info ->>'SectorName' as SectorName,info ->>'Finance' as Finance, info ->>'ValueScore' as ValueScore,info ->>'CompanyName' as CompanyName, info ->>'GrowthScore' as GrowthScore,info ->>'HealthScore' as HealthScore, info ->>'ReleaseDate' as ReleaseDate,info ->> 'QualityScore' as QualityScore,info ->> 'RankBySector' as RankBySector, info ->>'DividendScore' as DividendScore, info ->>'CompanyShortName' as CompanyShortName, info ->>'OverallMarketRank' as OverallMarketRank, info ->>'PastPerformanceScore' as PastPerformanceScore from kotaksec where info->>'SectorId' = $1",[a]);t.json(s.rows)}));const{response:s}=require("express"),{json:n}=require("body-parser");app.get("/api/mmmarkets",(function(e,t){request("https://frapi.marketsmojo.com/market_marketoverview/getData?",(function(e,o,a){e||t.json(JSON.parse(o.body))}))})),app.get("/api/etsharetoday",(function(e,t){let o=e.query.eqsymbol;request("https://ettechcharts.indiatimes.com/ETLiveFeedChartRead/livefeeddata?scripcode="+o+"EQ&exchangeid=50&datatype=intraday&filtertype=1MIN&tagId=10648&firstreceivedataid=&lastreceivedataid=&directions=all&scripcodetype=company",(function(e,o,a){e||t.json(JSON.parse(o.body))}))})),app.get("/api/etimesnews",(function(e,t){e.query.mcsymbol;request("https://economictimes.indiatimes.com/feed_marketslisting.cms?feedtype=json&msid=1977021501&curpg=1&callback=breakingnews",(function(e,o,a){e||t.json(o.body)}))})),app.get("/api/kotakhealthscore",((e,t)=>{console.log("This is Kotak Health Score");request("https://www.kotaksecurities.com/TSTerminal/Fundamentals/MasterData/GetHealthScoreScreenerData?sectorId=-1&marketCap=LC&healthScoreValue=A&defaultView=false",(function(e,a,s){if(!e){request({url:"https://mtrade.kotaksecurities.com/TSTerminal/Fundamentals/MasterData/GetHealthScoreScreenerData?sectorId=-1&marketCap=ALL&healthScoreValue=A&defaultView=true",method:"GET",headers:{accept:"text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9","accept-language":"en-US,en;q=0.9","cache-control":"max-age=0","sec-ch-ua":'" Not A;Brand";v="99", "Chromium";v="102", "Google Chrome";v="102"',"sec-ch-ua-mobile":"?0","sec-ch-ua-platform":'"Windows"',"sec-fetch-dest":"document","sec-fetch-mode":"navigate","sec-fetch-site":"none","sec-fetch-user":"?1","upgrade-insecure-requests":"1",cookie:'_fbp=fb.1.1653745914138.1241231693; _ga=GA1.2.1340509370.1653745738; _gcl_au=1.1.873030795.1653745910; _gid=GA1.2.232653205.1656570374; _nv_ab_cid=["4032","3490","2420","3655"]; _nv_ab_ver_6941_3655=4515; _nv_banner_x=22686; _nv_did=253330646.1653745752.1585996377122177135239zqaz7; _nv_hit=253330646.1656570370.cHZpZXc9MXxzdmlldz1bIjIyNjg2Il0=; _nv_uid=253330646.1653745752.46ba573e-2c31-47df-bc30-44347db76191.1655322664.1656570370.7.0; _nv_utm=253330646.1653745752.7.2.dXRtc3JjPWdvb2dsZXx1dG1jY249KG5vdCBzZXQpfHV0bWNtZD1vcmdhbmljfHV0bWN0cj0obm90IHByb3ZpZGVkKXx1dG1jY3Q9KG5vdCBzZXQpfGdjbGlkPShub3Qgc2V0KQ==; _uetsid=8bc2f710f83d11ecbfed9509e099e362; _uetvid=53ce8fa0de8d11ec8991b5e9297a9184; ASP.NET_SessionId=zu0jw02e0damnrpxt3ftuxk1; ORG36141=cab000d5-e326-4945-b583-d453ad82e69a; userTheme=; __stbpnenable=0; __stdf=0; __stgeo="0"; __stp={"visit":"returning","uuid":"2d792579-e291-4484-a4e6-d3f4ad444a47","ck":"A0YS2"}; __sts={"sid":1656586736305,"tx":1656586736305,"url":"https%3A%2F%2Fmtrade.kotaksecurities.com%2FTSTerminal%2FRealTime%2FWatchList%2FSRWatchList","pet":1656586736305,"set":1656586736305}; _gat_UA-10523021-12=1; _PLATFORMAUTH=6759D8917554FDFA2BC75FBAF7ED3FEF75B8AEFA4FF739FA908AF97EE706018ADB1AB1E8E24507C2CAE090141591E6D743F728ACE8E6B7C5302FC265629DFF5A5D277635C609EADA3A310492841E7ACF27DFF71A171E15894178417FB5A976DB1F5D066F9D84674F8B6E83D87841E0FEEA34CA5C3A0F2EB86625495A32E845026CC6958EFBF62C3BA5B45197051CF2363075BFE9EF81D24B12581257CE95C2515F5968BB167399D3A87E10F73FAD11607F612C43378398329B03CF8C083A002FFFE17E9E28364639E2B9B1C55692076EB0E9DFBCE4DDC15DF5BF35F36F2CE987868C24F8A25A90D865BAD46989C627C5B0673612C652A589010053999987F7F1D0EBB37339D1D391662D4BDE5085C7EF4E8A4877426A7344F2313BDC77DACE36E29E557669302F58A136BEF50E95069AF0006B25334A6FF653D8AE48B1EC1D769823B9166EC1C592393B664F987636D40789EF8B7103443AF00141DD5D5378F643C099B36A4DF3325FA79B92DA30B67ABAA8882851211C753A5359F4DF6F143F7AEBA866648F5221E407F67D3019EBDEE9D8416E3ED99A54D42DDEDD96A50CDB1015B288B37518D36CF49132BB6F19C50879E0F4F78F16F68F7EB5E288E391D9606C9C0328F24C2FA0A281665E1A177436E93D1A574DE0C7A0C9126F6C052A3526594FC92B039D488E6434F62A881DF32231FBF69AF14A103261E26F21808DA6A4BE1B543814B20D9BA6C96D2CDA31314171477DF2F78A5AAA9EFEFEAE223AFE27E53629791A0C92708402261E4BDD20A58333452720C1E9220458FA06FE76F9405048D56F66C9D5E4B593245DC6CC6C81AEE05F0681C984F25D69793D6A2FB06059AB88D0AEE9095DFE9BD2928B68688BD586547899FE35D1534AE0E276FE68D31B223F1F4C0805DAF57A6012F33703A3D9D837902133A004B8EA3E7E737C32B2B8A126; AppConnection=A0YS2-dfffab565faa46f5b5b679ab768e27e7'},referrerPolicy:"strict-origin-when-cross-origin",body:null,method:"GET"},((e,a,s)=>{if(e);else{t.json(JSON.parse(a.body));const e=JSON.parse(a.body);console.log(e.length),console.log("executing kotaksecurities");for(let t=0;t<e.length;t+=1){const a=e[t];console.log(a),o.query("INSERT INTO kotaksec (info) VALUES ($1)",[a],((e,t)=>{console.log(e,t)}))}}}))}}))})),app.get("/api/trendlynestocks1",((e,t)=>{let o=e.query.tlid,a=e.query.tlname,s=e.query.eqsymbol;console.log("This is tendlynestocks1"),request("https://trendlyne.com/equity/getStockMetricParameterList/"+o,(function(e,n,i){if(!e){var r={url:"https://trendlyne.com/equity/getStockMetricParameterList/"+o,method:"GET",headers:{accept:"application/json, text/javascript, */*; q=0.01","accept-language":"en-US,en;q=0.9","sec-ch-ua":'" Not A;Brand";v="99", "Chromium";v="101", "Google Chrome";v="101"',"sec-ch-ua-mobile":"?0","sec-ch-ua-platform":'"Windows"',"sec-fetch-dest":"empty","sec-fetch-mode":"cors","sec-fetch-site":"same-origin","x-requested-with":"XMLHttpRequest",cookie:process.env.trendlynecookie},referrer:"https://trendlyne.com/equity/"+o+"/"+s+"/"+a+"/",referrerPolicy:"strict-origin-when-cross-origin",body:null,method:"GET",mode:"cors",credentials:"include"};request(r,((e,o,a)=>{e||t.json(JSON.parse(a))}))}}))})),app.get("/api/trendlynestocks2",((e,t)=>{e.query.eqsymbol;let o=e.query.tlid;request("https://trendlyne.com/mapp/v1/stock/chart-data/"+o+"/SMA/",(function(e,o,a){e||t.json(JSON.parse(o.body))}))})),app.get("/api/trendlynenifty",((e,t)=>{request("https://trendlyne.com/mapp/v1/stock/web/ohlc/1887/TJLOGSVLZL4FLXDWFH6TIVYB6A======/",(function(e,o,a){if(!e){var s={url:"https://trendlyne.com/mapp/v1/stock/web/ohlc/1887/TJLOGSVLZL4FLXDWFH6TIVYB6A======/",method:"GET",headers:{accept:"application/json, text/javascript, */*; q=0.01","accept-language":"en-US,en;q=0.9","sec-ch-ua":'".Not/A)Brand";v="99", "Google Chrome";v="103", "Chromium";v="103"',"sec-ch-ua-mobile":"?0","sec-ch-ua-platform":'"Windows"',"sec-fetch-dest":"empty","sec-fetch-mode":"cors","sec-fetch-site":"same-origin","x-requested-with":"XMLHttpRequest",cookie:process.env.trendlynecookie,Referer:"https://trendlyne.com/equity/1887/NIFTY50/nifty-50/","Referrer-Policy":"strict-origin-when-cross-origin"},body:null,method:"GET"};request(s,((e,o,a)=>{e||t.json(JSON.parse(a))}))}}))})),app.get("/api/trendlynepharmanifty",((e,t)=>{request("https://trendlyne.com/mapp/v1/stock/web/ohlc/1905/URFM5UKYBSJM3HDF7EH5ZBSEP4======/",(function(e,o,a){if(!e){var s={url:"https://trendlyne.com/mapp/v1/stock/web/ohlc/1905/URFM5UKYBSJM3HDF7EH5ZBSEP4======/",method:"GET",headers:{accept:"application/json, text/javascript, */*; q=0.01","accept-language":"en-US,en;q=0.9","sec-ch-ua":'".Not/A)Brand";v="99", "Google Chrome";v="103", "Chromium";v="103"',"sec-ch-ua-mobile":"?0","sec-ch-ua-platform":'"Windows"',"sec-fetch-dest":"empty","sec-fetch-mode":"cors","sec-fetch-site":"same-origin","x-requested-with":"XMLHttpRequest",cookie:process.env.trendlynecookie,Referer:"https://trendlyne.com/equity/1887/NIFTY50/nifty-50/","Referrer-Policy":"strict-origin-when-cross-origin"},body:null,method:"GET"};request(s,((e,o,a)=>{e||t.json(JSON.parse(a))}))}}))})),app.get("/api/trendlynebanknifty",((e,t)=>{request("https://trendlyne.com/mapp/v1/stock/web/ohlc/1898/NAUN63XDUGR6O4FV2UAQPDQWSA======/",(function(e,o,a){if(!e){var s={url:"https://trendlyne.com/mapp/v1/stock/web/ohlc/1898/NAUN63XDUGR6O4FV2UAQPDQWSA======/",method:"GET",headers:{accept:"application/json, text/javascript, */*; q=0.01","accept-language":"en-US,en;q=0.9","sec-ch-ua":'".Not/A)Brand";v="99", "Google Chrome";v="103", "Chromium";v="103"',"sec-ch-ua-mobile":"?0","sec-ch-ua-platform":'"Windows"',"sec-fetch-dest":"empty","sec-fetch-mode":"cors","sec-fetch-site":"same-origin","x-requested-with":"XMLHttpRequest",cookie:process.env.trendlynecookie,Referer:"https://trendlyne.com/equity/1887/NIFTY50/nifty-50/","Referrer-Policy":"strict-origin-when-cross-origin"},body:null,method:"GET"};request(s,((e,o,a)=>{e||t.json(JSON.parse(a))}))}}))})),app.get("/api/trendlynestocks3",(function(e,t){let o=e.query.tlid;request("https://trendlyne.com/fundamentals/get-fundamental_results/"+o+"/",(function(e,t,o){e||console.log("This is tendlynestocks3")}))})),app.get("/api/trendlynestocksti",(function(e,t){let o=e.query.tlid;request("  https://trendlyne.com/mapp/v1/stock/adv-technical-analysis/"+o+"/24/",(function(e,o,a){e||(console.log("This is tendlynestocksti"),t.json(JSON.parse(o.body)))}))}));const i=axios.create({withCredentials:!0});e(i),i.defaults.jar=new t.CookieJar,app.post("/api/trendlynepostdvm",(async function(e,t){const o=e.body.map((e=>{axios.get("https://trendlyne.com/mapp/v1/stock/web/ohlc/"+e.tlid).then((t=>{obj1={Date:e.Date,Time:e.time,Name:e.name,DurabilityScore:t.data.body.stockData[6],VolatilityScore:t.data.body.stockData[7],MomentumScore:t.data.body.stockData[8]}})).catch((e=>{console.log(e)}))}));try{await Promise.all(o)}catch(e){console.log(e)}}));const r=axios.create({withCredentials:!0});e(r),r.defaults.jar=new t.CookieJar,app.get("/api/trendlynepost",(function(e,t){fetch("https://trendlyne.com/equity/api/getLivePriceList/",{headers:{accept:"application/json, text/javascript, */*; q=0.01","accept-language":"en-US,en;q=0.9","content-type":"application/x-www-form-urlencoded; charset=UTF-8","sec-ch-ua":'" Not;A Brand";v="99", "Google Chrome";v="91", "Chromium";v="91"',"sec-ch-ua-mobile":"?0","sec-fetch-dest":"empty","sec-fetch-mode":"cors","sec-fetch-site":"same-origin","x-csrftoken":"PTN4cA0cTjN9Zp1IwuZ7MhQ6rYdvMbGV","x-requested-with":"XMLHttpRequest",cookie:"csrftoken=PTN4cA0cTjN9Zp1IwuZ7MhQ6rYdvMbGV; _ga=GA1.2.2089860351.1627538215; _gid=GA1.2.1901289626.1627538215"},referrer:"https://trendlyne.com/features/",referrerPolicy:"strict-origin-when-cross-origin",body:"pks%5B%5D=1057&pks%5B%5D=1119&pks%5B%5D=1289&pks%5B%5D=1362&pks%5B%5D=1363&pks%5B%5D=1366&pks%5B%5D=1409&pks%5B%5D=147&pks%5B%5D=1887&pks%5B%5D=1888&pks%5B%5D=1895&pks%5B%5D=1896&pks%5B%5D=1898&pks%5B%5D=1900&pks%5B%5D=1902&pks%5B%5D=1905&pks%5B%5D=268&pks%5B%5D=276&pks%5B%5D=4482&pks%5B%5D=549&pks%5B%5D=629&pks%5B%5D=699&pks%5B%5D=79883&pks%5B%5D=804&pks%5B%5D=842&pks%5B%5D=878&pks%5B%5D=93115&force=false",method:"POST",mode:"cors"})})),app.get("/api/nsestockhistdata",(function(e,t){let o=e.query.stock;r.get("https://www.nseindia.com/").then((e=>r.get("https://www.nseindia.com/api/historical/cm/equity?symbol="+o+"&series=[%22EQ%22]&from=09-03-2021&to="+todaydate))).then((e=>t.json(e.data))).catch((e=>console.error(t.response)))})),app.get("/api/nseinstrading",(function(e,t){e.query.stock;r.get("https://www.nseindia.com/").then((e=>r.get("https://www.nseindia.com/api/corporates-pit?"))).then((e=>t.json(e.data))).catch((e=>console.error(t.response)))})),app.get("/api/nsedatastockohlc2",(function(e,t){let o=e.query.stock;r.get("https://www.nseindia.com/").then((e=>r.get("https://www.nseindia.com/api/quote-equity?symbol="+o+"&section=trade_info"))).then((e=>t.json(e.data))).catch((e=>console.error(t.response)))})),app.get("/api/nseresults",(function(e,t){r.get("https://www.nseindia.com/").then((e=>r.get("https://www.nseindia.com/api/event-calendar?index=equities&subject=Financial%20Results")),{headers:{"User-Agent":"Mozilla/4.0 (compatible; MSIE 5.01; Windows NT 5.0)",Referer:"http://www.nseindia.com/",Host:"http://www.nseindia.com/",Accept:"*/*",sameSite:"none"}}).then((e=>t.json(e.data))).catch((e=>console.error(t.response)))})),app.get("/api/nsedatastockohlc1",(function(e,t){let o=e.query.stock;r.get("https://www.nseindia.com/").then((e=>r.get("https://www.nseindia.com/api/quote-equity?symbol="+o))).then((e=>t.json(e.data))).catch((e=>console.error(t.response)))})),app.get("/api/nsedata2",(function(e,t){r.get("https://www.nseindia.com/").then((e=>r.get("https://www.nseindia.com/api/equity-stockIndices?index=NIFTY%2050"))).then((e=>t.json(e.data))).catch((e=>console.error(t.response)))})),app.get("/api/nsedata4",(function(e,t){r.get("https://www.nseindia.com/").then((e=>r.get("https://www.nseindia.com/api/liveEquity-derivatives?index=top20_contracts"))).then((e=>t.json(e.data))).catch((e=>console.error(t.response)))})),app.get("/api/nsedataadvdec",(function(e,t){r.get("https://www.nseindia.com/").then((e=>r.get("https://www1.nseindia.com/common/json/indicesAdvanceDeclines.json"))).then((e=>t.json(e.data))).catch((e=>console.error(t.response)))})),app.get("/api/nsedataindices",(function(e,t){r.get("https://www.nseindia.com/").then((e=>r.get("https://www1.nseindia.com/homepage/Indices1.json"))).then((e=>t.json(e.data)))})),app.get("/api/nsedatasioi",(function(e,t){e.query.stock;r.get("https://www.nseindia.com/").then((e=>r.get("https://www1.nseindia.com/live_market/dynaContent/live_analysis/oi_spurts/topPositiveOIChangeData.json"))).then((e=>t.json(e.data))).catch((e=>console.error(t.response)))})),app.get("/api/nsedatapioii",(function(e,t){e.query.stock;r.get("https://www.nseindia.com/").then((e=>r.get("https://www1.nseindia.com/live_market/dynaContent/live_analysis/oi_spurts/riseInPriceRiseInOI.json"))).then((e=>t.json(e.data))).catch((e=>console.error(t.response)))})),app.get("/api/nsedatapniftyoi",(function(e,t){e.query.stock;r.get("https://www.nseindia.com/").then((e=>r.get("https://www.nseindia.com/api/option-chain-indices?symbol=BANKNIFTY"))).then((e=>t.json(e.data))).catch((e=>console.error(t.response)))})),app.get("/api/nsedatastockoi",(function(e,t){let o=e.query.stock;r.get("https://www.nseindia.com/").then((e=>r.get("https://www.nseindia.com/api/option-chain-equities?symbol="+o))).then((e=>t.json(e.data))).catch((e=>console.error(t.response)))})),app.get("/api/nse22",(function(e,t){e.query.mcsymbol;return axios.get("https://www1.nseindia.com/corporates/corpInfo/equities/getResultCalendar.jsp?Symbol=&Industry=&Period=All%20Forthcoming&Purpose=&period=All%20Forthcoming&symbol=&industry=&purpose=")})),app.post("/api/nsepostdata1",(async function(e,t){let o=e.body;const a=o.map((e=>{r.get("https://www.nseindia.com/").then((t=>r.get("https://www.nseindia.com/api/quote-equity?symbol="+e.eqsymbol1+"&section=trade_info"))).then((t=>{t.data.securityWiseDP.deliveryToTradedQuantity?{symbol:e.eqsymbol1,percentage:t.data.securityWiseDP.deliveryToTradedQuantity}:console.log("No deliveryToTradedQuantity present ")})).catch((e=>{console.log(e)}))})).catch((e=>{console.log(e)})).catch((e=>console.error("There is error")));try{await Promise.all(a)}catch(e){console.log(e)}})),app.post("/api/nsepostdata2",(async function(e,t){const o=e.body.map((e=>{r.get("https://www.nseindia.com/").then((t=>r.get("https://www.nseindia.com/api/option-chain-equities?symbol="+e.eqsymbol1))).then((t=>{if(t.data.filtered.CE.totOI&&t.data.filtered.PE.totOI)e.eqsymbol1,t.data.filtered.PE.totOI,t.data.filtered.CE.totOI;else console.log("No Put/Call present ")})).catch((e=>{console.log(e)}))})).catch((e=>{console.log(e)})).catch((e=>console.error("There is error")));try{await Promise.all(o)}catch(e){console.log(e)}})),app.get("/api/opstradatanifty",(function(e,t){let o=e.query.nextexpiry;request("https://opstra.definedge.com/api/openinterest/free/NIFTY&"+o,(function(e,o,a){e||t.json(JSON.parse(o.body))}))})),app.get("/api/opstradatabanknifty",(function(e,t){let o=e.query.nextexpiry;request("https://opstra.definedge.com/api/openinterest/free/NIFTY&"+o,(function(e,o,a){e||t.json(JSON.parse(o.body))}))})),app.get("/api/opstrastockdata",(function(e,t){let o=e.query.nextexpirymonthly,a=e.query.eqsymbol;request("https://opstra.definedge.com/api/openinterest/free/"+a+"&"+o,(function(e,o,a){e||t.json(JSON.parse(o.body))}))})),app.get("/api/kite1",(function(e,t){let o=e.query.timeframe,a=e.query.eqsymbol;request("https://mo.streak.tech/api/tech_analysis/?timeFrame="+o+"&stock=NSE%3A"+a+"&user_id=",(function(e,o,a){e||t.json(JSON.parse(o.body))}))})),app.get("/api/niftytradersallstocks",(async function(e,t){request("https://api.niftytrader.in/api/NIndex/stocks_list_api",(function(e,o,a){e||t.json(JSON.parse(o.body))}))})),app.get("/api/ntniftypcr",(function(e,t){request("https://api.niftytrader.in/api/FinNiftyOI/niftypcrData?reqType=niftypcr",(function(e,o,a){e||t.json(JSON.parse(o.body))}))})),app.get("/api/ntstockdetails",((e,t)=>{let o=e.query.eqsymbol;request("https://api.niftytrader.in/webapi/Live/stockAnalysis",(function(e,a,s){e||request({url:"https://api.niftytrader.in/webapi/Live/stockAnalysis",method:"POST",headers:{accept:"application/json, text/plain, */*","accept-language":"en-US,en;q=0.9","content-type":"application/json","sec-ch-ua":'" Not A;Brand";v="99", "Chromium";v="101", "Google Chrome";v="101"',"sec-ch-ua-mobile":"?0","sec-ch-ua-platform":'"Windows"',"sec-fetch-dest":"empty","sec-fetch-mode":"cors","sec-fetch-site":"same-site"},referrer:"https://www.niftytrader.in/",referrerPolicy:"strict-origin-when-cross-origin",body:'{"symbol":"'+o+'"}',method:"POST",mode:"cors",credentials:"omit"},((e,o,a)=>{e||t.json(JSON.parse(a))}))}))})),app.get("/api/ntstockpcrdetails",((e,t)=>{let o=e.query.eqsymbol;request("https://api.niftytrader.in/webapi/Live/kiteInstrumentNfoListNew",(function(e,a,s){e||request({url:"https://api.niftytrader.in/webapi/Live/kiteInstrumentNfoListNew",method:"POST",headers:{accept:"application/json, text/plain, */*","accept-language":"en-US,en;q=0.9",authorization:"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI1NDMzOCIsImp0aSI6IjU5MjUwODYxLWRlNWYtNGFkZS1hZWY0LWRlMzg1YjcwYWQ1ZCIsImV4cCI6MTY1ODUwMjk1MSwiaXNzIjoiTmlmdHl0cmFkZXJoZWxwLmNvbSIsImF1ZCI6Ik5pZnR5dHJhZGVyaGVscC5jb20ifQ.RQyIer2CdUUd2Ge5pLlU8MJJCM-49W0aF3iuDJmZBb0","content-type":"application/json","sec-ch-ua":'".Not/A)Brand";v="99", "Google Chrome";v="103", "Chromium";v="103"',"sec-ch-ua-mobile":"?0","sec-ch-ua-platform":'"Windows"',"sec-fetch-dest":"empty","sec-fetch-mode":"cors","sec-fetch-site":"same-site",Referer:"https://www.niftytrader.in/","Referrer-Policy":"strict-origin-when-cross-origin"},body:'{"symbol":"'+o+'"}',method:"POST"},((e,o,a)=>{e||t.json(JSON.parse(a))}))}))})),app.post("/api/nr7",(async function(e,t){let a=e.body;const s=a.map((e=>{console.log(a);request("https://api.niftytrader.in/webapi/Live/stockAnalysis",(function(t,a,s){if(t)console.log(t);else if(!t){var n={url:"https://api.niftytrader.in/webapi/Live/stockAnalysis",method:"POST",headers:{accept:"application/json, text/plain, */*","accept-language":"en-US,en;q=0.9","content-type":"application/json","sec-ch-ua":'" Not A;Brand";v="99", "Chromium";v="101", "Google Chrome";v="101"',"sec-ch-ua-mobile":"?0","sec-ch-ua-platform":'"Windows"',"sec-fetch-dest":"empty","sec-fetch-mode":"cors","sec-fetch-site":"same-site"},referrer:"https://www.niftytrader.in/",referrerPolicy:"strict-origin-when-cross-origin",body:'{"symbol":"'+e.eqsymbol+'"}',method:"POST",mode:"cors",credentials:"omit"};request(n,((t,a,s,n)=>{if(t);else{data=JSON.parse(a.body),data2=data.resultData.stocktrend,obj1=[];for(let t in data2)"nr7_today"==t&&(console.log(data2.nr7_today),obj1.push({stock:e.name,isin:e.isin,Date:e.Date,nr7:data2.nr7_today}));console.log(obj1),console.log("executing nr7"),o.query("INSERT INTO nr7 (info)  VALUES ($1)",obj1,((e,t)=>{console.log(e,t)}))}}))}}))}));try{await Promise.all(s)}catch(e){console.log(e)}})),app.post("/api/nteodscreeners",((e,t)=>{let o=e.body;console.log(JSON.stringify(o));request("https://api.niftytrader.in/webapi/Screener/getAdvanceEodScreenerFilter",(function(e,a,s){if(!e){var n={url:"https://api.niftytrader.in/webapi/Screener/getAdvanceEodScreenerFilter",method:"POST",headers:{accept:"application/json, text/plain, */*","accept-language":"en-US,en;q=0.9",authorization:"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI1NDMzOCIsImp0aSI6IjU5MjUwODYxLWRlNWYtNGFkZS1hZWY0LWRlMzg1YjcwYWQ1ZCIsImV4cCI6MTY1ODUwMjk1MSwiaXNzIjoiTmlmdHl0cmFkZXJoZWxwLmNvbSIsImF1ZCI6Ik5pZnR5dHJhZGVyaGVscC5jb20ifQ.RQyIer2CdUUd2Ge5pLlU8MJJCM-49W0aF3iuDJmZBb0","content-type":"application/json","sec-ch-ua":'" Not A;Brand";v="99", "Chromium";v="102", "Google Chrome";v="102"',"sec-ch-ua-mobile":"?0","sec-ch-ua-platform":'"Windows"',"sec-fetch-dest":"empty","sec-fetch-mode":"cors","sec-fetch-site":"same-site"},referrer:"https://www.niftytrader.in/",referrerPolicy:"strict-origin-when-cross-origin",body:JSON.stringify(o),method:"POST",mode:"cors",credentials:"include"};request(n,((e,o,a)=>{e||t.json(JSON.parse(a))}))}}))})),app.get("/api/nteodscreeners1",((e,t)=>{request("https://api.niftytrader.in/webapi/Screener/getAdvanceEodScreenerFilter",(function(e,o,a){if(!e){request({url:"https://api.niftytrader.in/webapi/Screener/getAdvanceEodScreenerFilter",method:"POST",headers:{accept:"application/json, text/plain, */*","accept-language":"en-US,en;q=0.9",authorization:"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI1NDMzOCIsImp0aSI6IjU5MjUwODYxLWRlNWYtNGFkZS1hZWY0LWRlMzg1YjcwYWQ1ZCIsImV4cCI6MTY1ODUwMjk1MSwiaXNzIjoiTmlmdHl0cmFkZXJoZWxwLmNvbSIsImF1ZCI6Ik5pZnR5dHJhZGVyaGVscC5jb20ifQ.RQyIer2CdUUd2Ge5pLlU8MJJCM-49W0aF3iuDJmZBb0","content-type":"application/json","sec-ch-ua":'" Not A;Brand";v="99", "Chromium";v="102", "Google Chrome";v="102"',"sec-ch-ua-mobile":"?0","sec-ch-ua-platform":'"Windows"',"sec-fetch-dest":"empty","sec-fetch-mode":"cors","sec-fetch-site":"same-site"},referrer:"https://www.niftytrader.in/",referrerPolicy:"strict-origin-when-cross-origin",body:"{'_20_day_sma_below': 'true','cci_200_below': 'true'}",method:"POST",mode:"cors",credentials:"include"},((e,o,a)=>{e||t.json(JSON.parse(a))}))}}))})),app.use(express.static(__dirname+"/")),app.get("/",(function(e,t){t.sendFile(path.join(__dirname+"/dist/index.html"))})),app.listen(8090,(function(){console.log("Your node is running on port 8090")}))}